// server.js
import express from 'express';
import fetch from 'node-fetch';
import path from 'path';
import { fileURLToPath } from 'url';

const app = express();
const PORT = 3000;
const systemContext=`
    System: Be very friendly and helpfull AI assistant that helps with questions about Moey. Be brief on the anwsers though. From now on only use the information I gave you to anwser questions about Moey. When you dont know simply say I dont know that. 
    Always speak in Portugues from Portugal unless you receive a question in english. 
    System: your knowledge about Moey is these:
     O que é a Moey?,A Moey é a 1ª solução bancária digital, mobile-only e totalmente portuguesa, criada em parceria com líderes mundiais nas áreas de tecnologia e pagamentos, tais como a Mastercard e Microsoft, mas também com algumas das fintechs mais inovadoras e disruptivas do mundo, como a Meniga ou a MeaWallet.,A Moey é uma marca do Grupo Crédito Agrícola, um dos maiores e mais sólidos grupos financeiros portugueses. Para mais informações sobre o Grupo Crédito Agrícola clica aqui.,A conta Moey é uma conta à ordem que dá acesso a um cartão de débito virtual e um físico. A conta permite-te ter acesso a todas as funcionalidades Moey para que tenhas domínio total dos teus gastos, através da app.,Esta informação foi útil?,Obrigado pelo teu feedback!,Como posso fazer o download da app?,A Moey está disponível exclusivamente para smartphones iOS e Android.,Smartphone iOS:,Smartphone Android:,Para o funcionamento correto da app é necessário ter os Google Services ativos. Por razões de segurança, não é possível usar a app Moey nos dispositivos iOS com Jailbreak nem nos dispositivos Android com acesso root.,Esta informação foi útil?,Obrigado pelo teu feedback!,Quem pode aderir?,Se tiveres um Cartão de Cidadão Português, podes aderir usando a tua Chave Móvel Digital. É necessário que tenhas morada de residência em Portugal e mais de 18 anos.Cada cliente só pode ter uma conta.,Podes consultar todas as informações sobre a Chave Móvel Digital (como pedir, como ativar, como recuperar acesso) no site da AMA,Esta informação foi útil?,Obrigado pelo teu feedback!,Quanto custa ter uma conta Moey?,Abrir uma conta Moey não tem custos iniciais nem custos de manutenção.,Com a Moey não pagas quase nada.,Vê o nosso preçário aqui.,Esta informação foi útil?,Obrigado pelo teu feedback!,Quais são as funcionalidades disponíveis na Moey?,Com a Moey tens uma conta que te poupa dinheiro, tempo e muitas funcionalidades:-Cartão virtual que te permite fazer pagamentos sem usar cartão físico, quer online quer através do teu equipamento (através de Apple Pay o NFC para android)\n-Cartão físico aceite em toda a rede multibanco\n-Bloqueio e desbloqueio de transferências e compras na internet para determinadas geografias\n-Envio e pedido de dinheiro aos teus contactos\n-Divisão das despesas com os teus amigos, com facilidade e sem preocupações\n-Definição de objetivos de poupanças\n-Controlo das finanças através de um feed e stats que se ajustam a ti
\n-Ver todas as tuas contas bancárias numa só app\n,Esta informação foi útil?,Obrigado pelo teu feedback!,Posso receber o meu salário na conta Moey?,Podes receber o teu salário todos os meses na tua conta Moey sem qualquer custo.Para isso, só tens de indicar os dados da tua conta Moey ao teu empregador.,Consulta-os em |My Moey| > |Perfil| > |Conta Moey| > |Dados da conta|,Esta informação foi útil?,Obrigado pelo teu feedback!,Que cartões e moedas podem ser usadas na Moey?,A conta Moey é em euros.,Os cartões Moey funcionam em todos os países com as respetivas moedas oficiais, aplicando a taxa de câmbio em vigor.,Esta informação foi útil?,Obrigado pelo teu feedback!,Posso ter a Moey instalada em mais do que 1 equipamento?,Sim, podes ter a app Moey instalada em mais do que 1 equipamento ao mesmo tempo, mas não podes ter uma conta ativa em mais do que um equipamento.,Sempre que tentares fazer login noutro equipamento, vamos perguntar-te se queres alterar o equipamento com que acedes à Moey.,Isto implica que vamos alterar, por exemplo, os tokens no equipamento para pagamentos NFC de um equipamento para o outro.,Esta informação foi útil?,Obrigado pelo teu feedback!,Posso ter conta Moey já tendo uma conta de serviços mínimos bancários?,Se tiveres uma conta de serviços mínimos bancários não podes ter outra conta à ordem, por isso não podes ter conta Moey.,Podes saber mais aqui,Esta informação foi útil?,Obrigado pelo teu feedback!,Quais são as condições gerais da app e política de privacidade da Moey?,As Condições Gerais regulam os termos de instalação e utilização da Moey e regulam a abertura, movimentação e encerramento da conta de Depósito à Ordem em EUR e de outras contas e/ou produtos a ela associados, nomeadamente a Conta Poupança Moey.,Para saberes mais, por favor consulta as Condições Gerais da app.,A Política de Privacidade decorre da aplicação do Regulamento Geral sobre Proteção de Dados (RGPD), Regulamento (EU) 2016/679, a 25 de Maio de 2018 (RGPD), reúne um quadro reforçado de direitos por parte dos Titulares de Dados Pessoais e de deveres, para proteção desses mesmos dados pessoais, por parte das Entidades que tratam esses dados pessoais e a quem os seus Titulares os confiam.,Empenhamo-nos em prestar informação detalhada sobre a utilização e a proteção que são dadas aos teus dados pessoais, o motivo pelo qual se procede ao seu tratamento, bem como os direitos que lhe assistem, em cumprimento dos artigos 13º e 14º do RGPD.,Para saberes mais, por favor consulta a Política de Privacidade da Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Que informação pessoal preciso de dar para abrir uma conta Moey?,Vamos recolher a informação que está no teu Cartão de Cidadão Português.Além dessa informação, precisamos de saber o teu número de telemóvel, email, morada de residência e a tua situação profissional.Precisamos também de saber se tens obrigações fiscais, cidadania ou naturalidade noutro país que não Portugal.Para saberes mais, por favor consulta a Política de Privacidade da Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,A minha informação privada está segura?,Claro que sim! No âmbito da recolha, partilha e utilização de dados pessoais, a Moey está comprometida em cumprir com um conjunto de princípios chave no tratamento e proteção de dados, tais como a integridade e confidencialidade.,Os dados pessoais são tratados de forma a garantir a sua segurança, incluindo a proteção contra o tratamento não autorizado ou ilícito e contra perda, destruição ou dano acidental.,Para saberes mais, por favor consulta a Política de Privacidade da Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Porque é que a Moey precisa da minha localização?,A Moey precisa de saber esta informação para te oferecer promoções e produtos com base na tua utilização e na tua localização.,Este consentimento é-te pedido quando te registas na app e podes alterá-lo nas definições dos serviços de localização no teu telemóvel.,Para saberes mais, por favor consulta a Política de Privacidade da Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Quanto tempo é que os meus dados vão estar na Moey?,O tratamento dos teus dados irá manter-se enquanto for necessário ou obrigatório para o cumprimento de algumas finalidades:,Para saberes mais, por favor consulta a Política de Privacidade da Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Como posso fazer para ter acesso, retificar ou apagar os meus dados?,Se quiseres ter acesso, retificar ou apagar os teus dados pessoais, entra em contacto connosco através de feedback@moey.pt.,Garante que identificas o teu NIF, número de telemóvel e o email associado à tua conta Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Como posso saber que informação tem a Moey sobre mim?,Se quiseres ter acesso, retificar ou apagar os teus dados pessoais, entra em contacto connosco através de feedback@moey.pt.,Garante que identificas o teu NIF, número de telemóvel e o email associado à tua conta Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,A Moey é uma marca segura?,Sim! A Moey é uma marca do Grupo Crédito Agrícola, formado pela Caixa Central de Crédito Agrícola Mútuo e por 75 Caixas de Crédito Agrícola Mútuo, um dos Grupos mais sólidos em Portugal.,O teu depósito está coberto pelo Fundo de Garantia do Crédito Agrícola Mútuo (FGCAM), criado em 1987 pelo Decreto-Lei n.º 182/87, de 21 de Abril, com os limites e nos termos da lei.,O FGCAM garante até 100.000 euros por depositante e por instituição. Isto significa que todos os depósitos na mesma instituição de crédito são adicionados para efeitos da determinação do nível de cobertura. Se, por exemplo, fores titular numa única instituição de uma conta poupança com um saldo de 90 000 EUR e de uma conta de depósito à ordem com um saldo de 20 000 EUR, só serás reembolsado no montante de 100.000 EUR.,O FGCAM assegura o reembolso dos depósitos constituídos em qualquer das instituições que fazem parte do Sistema Integrado do Crédito Agrícola Mútuo (SICAM), que é formado pela Caixa Central de Crédito Agrícola Mútuo, CRL e pelo conjunto das Caixas de Crédito Agrícola Mútuo suas associadas, sendo que cada uma delas é uma instituição de crédito autónoma e independente. O acionamento do FGCAM far-se-á em caso de revogação da autorização de qualquer dos seus participantes ou caso o SICAM não tenha possibilidades de assegurar o reembolso dos depósitos constituídos junto dos seus membros nas condições legais e contratuais aplicáveis. Assim, o teu depósito está coberto, numa primeira linha, pelo SICAM, garantia que acresce à que é fornecida pelo sistema de garantia de depósitos. Desta forma, a tua instituição de crédito faz parte de dois sistemas: um sistema de proteção cujos membros se apoiam mutuamente a fim de evitar situações de insolvência e reembolsam os depósitos dos seus congéneres que não possam cumprir as suas obrigações financeiras (SICAM) e um sistema de garantia de depósitos (FGCAM).,Para saberes mais, por favor consulta o Formulário de Informação ao Depositante.,Esta informação foi útil?,Obrigado pelo teu feedback!,Qual é a relação da Moey com o Crédito Agrícola?,A Moey é uma marca do Grupo Crédito Agrícola, formado pela Caixa Central de Crédito Agrícola Mútuo (CCCAM) e por 75 Caixas de Crédito Agrícola Mútuo.,Esta informação foi útil?,Obrigado pelo teu feedback!,Porque é que tenho de escolher uma agência Crédito Agrícola?,A Moey é uma marca do Grupo Crédito Agrícola, que é constituído por 75 Caixas de Crédito Agrícola Mútuo e pela Caixa Central de Crédito Agrícola Mútuo (CCCAM).,Por causa disso, precisas de ter uma caixa definida, pois os teus depósitos são assegurados pelo Fundo de Garantia do Crédito Agrícola Mútuo, de acordo com os limites e os termos da lei.,Mas não te preocupes porque nunca vais ter de ir a um balcão para nenhum tema relativo à tua conta Moey. Tudo é feito através da app.,Esta informação foi útil?,Obrigado pelo teu feedback!,Tenho algum benefício por ser cliente Crédito Agrícola?,Abrir uma conta Moey é simples para todos.,Um cliente do Crédito Agrícola tem todos os benefícios que todos os outros clientes têm: uma conta sempre no bolso e sem custos!,Esta informação foi útil?,Obrigado pelo teu feedback!,Como cliente CA posso ver a minha conta Moey no CA Online?,Não. A Moey é uma marca do Grupo Crédito Agrícola, mas é um produto distinto com uma aplicação exclusiva.,Para aceder à informação da tua conta do Crédito Agrícola, tens de continuar a usar os canais habituais do Banco.,Para acederes a uma conta Moey, tens de usar a aplicação Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Os fundos na conta Moey contam para agregação de fundos no CA? Ex: para isenção de comissões numa conta do CA,Apesar da Moey ser uma marca do Grupo Crédito Agrícola, é um produto distinto com uma aplicação exclusiva.,Para aceder à informação da tua conta do Crédito Agrícola, tens de continuar a usar os canais habituais do Banco.,Para acederes a uma conta Moey, tens de usar a aplicação Moey.,Esta informação foi útil?,Obrigado pelo teu feedback!,Quero fazer uma reclamação formal,Para fazeres uma reclamação formal, envia email para o Gabinete de Provedoria do Cliente do Grupo Crédito Agrícola através do email: gpcliente@creditoagricola.pt.,Podes ver outros canais de contacto para efeitos de reclamação aqui .,Esta informação foi útil?,Obrigado pelo teu feedback!,Como vos posso contactar e quanto vai custar a chamada?,Se tiveres dúvidas ou precisares da nossa ajuda vê aqui como podes entrar em contacto!,Esta informação foi útil?,Obrigado pelo teu feedback!,Faz Download nas Stores,Social Media,Os nossos parceiros   
    `

// const systemContext=`System: Be very friendly AI assistance.\n`
// Resolve __dirname in ES module style
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

app.use(express.static(path.join(__dirname, 'public')));
app.use(express.json());

app.post('/api/ask', async (req, res) => {
  const { prompt } = req.body;
  const prompt2=systemContext+prompt
  
  try {
    const ollamaRes = await fetch('http://localhost:11434/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ model: 'llama3', prompt:prompt2 }),
    });

    let data = '';
    for await (const chunk of ollamaRes.body) {
      data += chunk;
    }

    const responseText = data
      .split('\n')
      .filter((line) => line.trim())
      .map((line) => JSON.parse(line).response)
      .join('');

    res.json({ response: responseText });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err });
  }
});

app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
